<!DOCTYPE html>
<link rel="apple-touch-icon-precomposed" sizes="152x152" href="http://jet.php5.cz/thebox/favicon/apple-touch-icon-152x152.png" />
<link rel="icon" type="image/png" href="http://jet.php5.cz/thebox/favicon/favicon-196x196.png" sizes="196x196" />
<meta name="application-name" content="&nbsp;" />
<meta name="msapplication-TileColor" content="#FFFFFF" />
<meta name="msapplication-TileImage" content="http://jet.php5.cz/thebox/favicon/mstile-144x144.png" />
<meta name="msapplication-wide310x150logo" content="http://jet.php5.cz/thebox/favicon/mstile-310x150.png" />
<meta name="msapplication-square310x310logo" content="http://jet.php5.cz/thebox/favicon/mstile-310x310.png" />
<html>
<head>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.0/jquery.min.js"></script>
    <link rel="stylesheet" type="text/css" href="http://jet.php5.cz/thebox/css/menu.css">
    <title>The Box - Home</title>
    <script>
        $(document).ready(function () {
            getInputsRepeat();

            var rb = document.getElementsByName('r2');
            for (i = 0; i < rb.length; i++) {
                rb[i].onclick = function () {
                    console.log(this.value);
                    $.ajax({
                        type: "POST",
                        url: "relays.data",
                        data: "2=" + this.value,
                        complete: getInputs()
                    });
                };
            }

            var rb = document.getElementsByName('r2');
            for (i = 0; i < rb.length; i++) {
                rb[i].onclick = function () {
                    console.log(this.value);
                    $.ajax({
                        type: "POST",
                        url: "relays.data",
                        data: "2=" + this.value,
                        complete: getInputs()
                    });
                };
            }
            var rb = document.getElementsByName('r3');
            for (i = 0; i < rb.length; i++) {
                rb[i].onclick = function () {
                    console.log(this.value);
                    $.ajax({
                        type: "POST",
                        url: "relays.data",
                        data: "3=" + this.value,
                        complete: getInputs()
                    });
                };
            }
            var rb = document.getElementsByName('r4');
            for (i = 0; i < rb.length; i++) {
                rb[i].onclick = function () {
                    console.log(this.value);
                    $.ajax({
                        type: "POST",
                        url: "relays.data",
                        data: "4=" + this.value,
                        complete: getInputs()
                    });
                };
            }
        }); //end of on document ready

        //get inputs once
        function getInputs() {
            $.ajax({
                type: "GET",
                url: "sensors.xml",
                cache: false,
                dataType: "xml",
                success: xmlParseInputs,
            });
        }

        //get inputs repeatedly
        function getInputsRepeat() {
            $.ajax({
                type: "GET",
                url: "sensors.xml",
                cache: false,
                dataType: "xml",
                success: xmlParseInputs,
                complete: function () {
                    setTimeout(getInputsRepeat, 5000);
                }
            }
            );
        }
        //parse inputs
        function xmlParseInputs(xml) {
            //sensor values
            $(xml).find("Sen V").each(function () {
                var i = $(this).index();
                var value = $(this).text().trim();
                $(".sensor").eq(i).text(value);
            })
            //relay radio buttons
            $(xml).find("Mod M").each(function () {
                var i = $(this).index();
                var mode = $(this).text().trim();
                var name = "r" + String(i + 1);
                var elements = document.getElementsByName(name);
                switch (parseInt(mode)) {
                    case 1:
                        elements[0].checked = true;
                        break;
                    case 0:
                        elements[1].checked = true;
                        break;
                    case 2:
                        elements[2].checked = true;
                        break;
                    default:
                        break;
                }
            })
            //color labels for relays
            var element = $(document).find('.state');
            $(xml).find("States S").each(function () {
                var i = $(this).index();
                var state = $(this).text().trim();
                switch (parseInt(state)) {
                    case 1:
                        element[i].style.background = "green";
                        break;
                    case 0:
                        element[i].style.background = "#c70000";
                        break;
                    default:
                        break;
                }
            })
            //grey out invalid remote values
            var elements = $(document).find('.remote');
            var valid = $(xml).find("OK").text().trim();
            for (i = 0; i < elements.length; i++) {
                if (parseInt(valid) == 0) elements[i].style.color = "#888";
                else elements[i].removeAttribute("style");
            }
        };

    </script>
    <style media="screen" type="text/css">
        input[type=radio] {
            margin: 0;
            vertical-align: middle;
            width: 100%;
            height: 2em;
        }

        body {
            margin: 0;
            padding: 0;
            background: #ccc;
        }

        .content {
            display: block;
            font-family: 'Oswald', sans-serif;
            background: white;
            padding: 15px 15px 15px 15px;
            margin: 15px 15px 15px 15px;
            -moz-box-shadow: 0 2px 15px 0 rgba(0,0,0,.2);
            -webkit-box-shadow: 0 2px 15px 0 rgba(0,0,0,.2);
            box-shadow: 0 2px 15px 0 rgba(0,0,0,.2);
        }

        .wrapContent {
            width: 650px;
        }

        table {
            border-collapse: collapse;
            text-align: left;
            width: 100%;
            border: 1px solid #ccc;
        }

            table thead th {
                background: #333;
                color: #FFFFFF;
                padding: 18px;
                text-align: center;
                text-transform: uppercase;
                padding-left: 20px;
                padding-right: 20px;
                font-size: 1.1em;
            }

            table .leftHeader {
                background: #333;
                color: #FFFFFF;
                text-align: right;
                text-transform: uppercase;
            }

            table td {
                padding: 10px 10px;
                text-align: center;
                background: #efefef;
                transition: .3s background-color;
            }

            table .subtitle {
                font-weight: normal;
                background-color: #555;
                padding: 8px;
                font-size: 0.75em;
            }
    </style>

</head>
<body>
    <header>
        <div class="nav">
            <ul>
                <li><a class="active" href="index.htm">Home</a></li>
                <li><a href="graphs1.htm">Graphs 1</a></li>
                <li><a href="graphs2.htm">Graphs 2</a></li>
                <li><a href="sched.htm">Scheduler</a></li>
                <li><a href="system.htm">System</a></li>
            </ul>
        </div>
    </header>
    <div class="wrapContent">
        <div class="content">
            <table>
                <thead>
                    <tr>
                        <th rowspan="2">Sensors
                        </th>
                        <th>Main Unit</th>
                        <th colspan="2">Remote Unit</th>
                    </tr>
                    <tr>
                        <th class="subtitle">Air</th>
                        <th class="subtitle">Air</th>
                        <th class="subtitle">Soil</th>
                    </tr>
                </thead>
                <tr>
                    <td class="leftHeader">Temperature</td>
                    <td><span class="sensor"></span>&deg;C</td>
                    <td class="remote"><span class="sensor"></span>&deg;C</td>
                    <td class="remote"><span class="sensor"></span>&deg;C</td>
                </tr>
                <tr>
                    <td class="leftHeader">Humidity</td>
                    <td><span class="sensor"></span>%RH</td>
                    <td class="remote"><span class="sensor"></span>%RH</td>
                    <td class="remote"><span class="sensor"></span>%RH</td>
                </tr>
                <tr>
                    <td class="leftHeader">Pressure / Weather</td>
                    <td colspan="3"><span class="sensor"></span>hPa&nbsp;/&nbsp;<span class="sensor"></span></td>
                </tr>
                <tr>
                    <td class="leftHeader">Light</td>
                    <td></td>
                    <td class="remote" colspan="2"><span class="sensor"></span>%</td>
                </tr>
                <tr>
                    <td class="leftHeader">Rain</td>
                    <td>&nbsp;</td>
                    <td class="remote" colspan="2"><span class="sensor"></span>mm/h</td>
                </tr>
            </table>
        </div>

        <div class="content">
            <table>
                <thead>
                    <tr>
                        <th rowspan="2">Relays
                        </th>
                        <th>Relay 1
                        </th>
                        <th>Relay 2
                        </th>
                        <th>Relay 3
                        </th>
                        <th>Relay 4
                        </th>
                    </tr>
                    <tr>
                        <th class="subtitle">Left socket</th>
                        <th class="subtitle">Bottom terminal</th>
                        <th class="subtitle">Top terminal</th>
                        <th class="subtitle">Right socket</th>
                    </tr>
                </thead>
                <tr>
                    <td class="leftHeader">Status</td>
                    <td class="state">&nbsp;
                    </td>
                    <td class="state">&nbsp;
                    </td>
                    <td class="state">&nbsp;
                    </td>
                    <td class="state">&nbsp;
                    </td>
                </tr>
                <tr>
                    <td class="leftHeader" style="background-color: green">ON</td>
                    <td>
                        <input type="radio" name="r1" value="1">
                    </td>
                    <td>
                        <input type="radio" name="r2" value="1">
                    </td>
                    <td>
                        <input type="radio" name="r3" value="1">
                    </td>
                    <td>
                        <input type="radio" name="r4" value="1">
                    </td>
                </tr>
                <tr>
                    <td class="leftHeader" style="background-color: #c70000">OFF</td>
                    <td>
                        <input type="radio" name="r1" value="0">
                    </td>
                    <td>
                        <input type="radio" name="r2" value="0">
                    </td>
                    <td>
                        <input type="radio" name="r3" value="0">
                    </td>
                    <td>
                        <input type="radio" name="r4" value="0">
                    </td>
                </tr>
                <tr>
                    <td class="leftHeader" style="background-color: #006097">AUTO</td>
                    <td>
                        <input type="radio" name="r1" value="2">
                    </td>
                    <td>
                        <input type="radio" name="r2" value="2">
                    </td>
                    <td>
                        <input type="radio" name="r3" value="2">
                    </td>
                    <td>
                        <input type="radio" name="r4" value="2">
                    </td>
                </tr>
            </table>
        </div>
    </div>
</body>
</html>
